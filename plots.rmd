---
title: "Twitter_and_shakemap_plots"
author: "Kristin Robinson"
date: "April 18, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

# load libraries
library(tidyverse)
library(stringr)
library(dplyr)
library(readr)
library(chunked)
library(ff)
library(maps)
library(ggmap)
library(lubridate)
library(gsheet)
library(ggplot2)
library(viridis)

options(stringsAsFactors = FALSE)
```

Napa earthquake August 24, 2014 10:20:44 UTC
epicenter: 38.22?N 122.31?W
https://en.wikipedia.org/wiki/2014_South_Napa_earthquake


```{r shake-data}

shakemap_data <- read.csv("data/shakemap/shakemap.csv", header=TRUE)
shakemap_data <- na.omit(shakmap_data)

```

```{r twitter-data}
# load data - longitude and latitude already transformed
twitter_data <- read.csv("data/twitter_31days.csv")
twitter_data_10min <- twitter_data <- subset(twitter_data, 
                             twitter_data$Timestamp >= ('2014-08-24 04:20:00') &
                            twitter_data$Timestamp <= ('2014-08-24 04:29:59') )

```

```{r plot-tweets-per-10-sec}
# plot no. of tweets in 10 sec intervals
ggplot(twitter_data_10min, aes(Timestamp)) +
  geom_freqpoly(binwidth = 10) +
  labs(x = "Time (CDT)", y = "Number of tweets", title = "Tweets over time (10 second intervals)")
# could also use + geom_histogram
```

```{r hist-tweets-over-time-mins}
# add column of time: minutes from eq
twitter_data_10min$minutes <- minute(twitter_data_10min$Timestamp)-20

# plot no. of tweets in 1 min intervals
ggplot(twitter_data_10min, aes(minutes)) +
  geom_histogram() +
  labs(x = "Minutes after earthquake", y = "Number of tweets", title = "Number of tweets over time (minute intervals)")
```

```{r plot-distance-from-epicenter}

# plot number of tweets by distance from epicenter
ggplot(twitter_data_10min, aes(dist)) +
  geom_freqpoly(binwidth = 1) +
  labs(x = "miles from epicenter", title = "# of Tweets by Distance from Epicenter")

# plot number of tweets by time by distance (distance <= 500 miles)
ggplot(twitter_data_10min, aes(x = Timestamp, y = dist)) + geom_point() +ylim(0,100) + labs(title="Tweets by distance by time\n(distance < 500 miles)", x = "time", y="distance (miles)")

```




```{r map-tweets}
# get california map
napa_map <- get_map(location = "napa, ca", 
                     source = "google",
                     maptype = "terrain", 
                     crop = FALSE,
                     zoom = 9)

# plot twitter data
ggmap(napa_map) +
  geom_point(data = twitter_data_10min, 
             col = "red", 
             size = .1,
             aes(x = lon, 
                 y = lat),
             shape = 19) +
  guides(fill = FALSE, 
         alpha = FALSE, 
         size = FALSE)

```

```{r}

# plot shakemap intensity
ggmap(napa_map) +
  geom_point(data=shakemap_data, aes(x=longitude, y= latitude, color = intensity), alpha = 1) + scale_color_continuous(low = "yellow", high = "red")

  
```


```{r}

# plot twitter & shake intensity data
ggmap(napa_map) +
  geom_point(data=shakemap_data, aes(x=longitude, y= latitude, color = intensity), alpha = 1) + scale_color_continuous(low = "yellow", high = "red")+
  geom_point(data = twitter_data_10min, 
             col = "green", 
             size = .1,
             aes(x = lon, 
                 y = lat),
             shape = 19)
```